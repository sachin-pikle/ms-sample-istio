box: combient/java-mvn

deploy:
  #box:
        #id: alpine
        #cmd: /bin/sh

  steps:        
    #- kubectl:
    #    name: create deployment
    #    server: $KUBERNETES_MASTER
    #    token: $KUBERNETES_TOKEN
    #    insecure-skip-tls-verify: true
    #    command: apply -f <(istioctl kube-inject -f bookinfo.yaml)

    # Register Inventory REST service in APIP
    - shellcheck
    
    - script:
      name: Install kubectl
      code: |
        echo "Installing version $KUBERNETES_VERSION of kubernetes"
        curl -LO https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl
        $chmod +x ./kubectl

    - script:
      name: Deploy the bookinfo app with istio sidecar injection
      code: |
        echo "Deploy the bookinfo app with istio sidecar injection"
        kubectl apply -f <(istioctl kube-inject -f bookinfo.yaml)
